function initCoupon(){require(["coupons"],function(t){t.getSendList()})}function searchcoupon(){require(["coupons"],function(t){t.getSendList()})}define("core",[],function(){function submitPwd(t){$.ajax({type:"POST",data:t,url:getHost()+"/member/updatePwd",success:function(t){var e=JSON.parse(t);console.log(e),e.status?(layer.msg("密码修改成功！"),$("#pwd-modal").modal("hide")):layer.msg("密码修改失败！")}})}var doTinit=function(){doT.templateSettings={evaluate:/\[\%([\s\S]+?)\%\]/g,interpolate:/\[\%=([\s\S]+?)\%\]/g,encode:/\[\%!([\s\S]+?)\%\]/g,use:/\[\%#([\s\S]+?)\%\]/g,define:/\[\%##\s*([\w\.$]+)\s*(\:|=)([\s\S]+?)#\%\]/g,conditional:/\[\%\?(\?)?\s*([\s\S]*?)\s*\%\]/g,iterate:/\[\%~\s*(?:\%\]|([\s\S]+?)\s*\:\s*([\w$]+)\s*(?:\:\s*([\w$]+))?\s*\%\])/g,varname:"it",strip:!0,append:!0,selfcontained:!1}},getHost=function(){var t=location.origin||location.protocol+"//"+location.hostname+(80==location.port?"":":"+location.port);return t},exeError=function(t,e,n,s){if("http"==t.type){var o="status:"+e.status+" state:"+e.readyState+" text:"+n+" err:"+JSON.stringify(s);t.desc=o}console.log("错误处理："+JSON.stringify(t))},formatDate=function(){Date.prototype.format=function(t){t||(t="yyyy-MM-dd hh:mm:ss");var e={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var n in e)new RegExp("("+n+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[n]:("00"+e[n]).substr((""+e[n]).length)));return t}},ReConsole=function(){window.console=window.console||function(){var t={};return t.log=t.warn=t.debug=t.info=t.error=t.time=t.dir=t.profile=t.clear=t.exception=t.trace=t.assert=function(){},t}()},isExitsFunction=function(funcName){try{if("function"==typeof eval(funcName))return!0}catch(e){}return!1},isExitsVariable=function(t){try{return"undefined"!=typeof t}catch(e){}return!1};return $(document).on("click","#branner .download",function(){try{localStorage.setItem("is_show",!0)}catch(t){}}),$(document).on("click","#upgrade-bar .sui-close",function(){try{localStorage.setItem("upgrade-version",CURRENT_VERSION)}catch(t){}}),$(document).on("shown","#pwd-modal",function(){$("#pwd-form").validate({success:function(t){var e=t.serializeArray();submitPwd(e)}})}),$(document).on("hidden","#pwd-modal",function(){$("#pwd-form")[0].reset()}),$(function(){$.ajax({type:"get",url:getHost()+"/helpful/upgrade",dataType:"json"}).done(function(t){return t.status&&t.result.items.length?($("#upgrade-bar").find(".upgrade-title").empty().append(t.result.items[0].title).end().show(),$("#upgrade").find(".upgrade-content").empty().append(t.result.items[0].content),void(200==t.result.items[0].tips_type&&$("#upgrade-bar").hide())):null})}),$(function(){$.ajax({type:"POST",url:getHost()+"/store/getGrcode",success:function(t){1!=t&&$("#grcode").attr("src",t)},error:function(t,e){console.log("status:"+t.status),console.log("state:"+t.readyState),console.log("text:"+e)}})}),{doTinit:doTinit,getHost:getHost,exeError:exeError,formatDate:formatDate,ReConsole:ReConsole,isExitsVariable:isExitsVariable,isExitsFunction:isExitsFunction}}),define("service/pagin",[],function(){return $.fn.pagination.Constructor.prototype=$.extend($.fn.pagination.Constructor.prototype,{_drawCtrl:function(){var t="";if(this.pageSize&&this.itemsCount){var e=$('<select class="page-size-sel"></select>'),n=[15,30,50,100];for(var s in n){var o='<option value="'+n[s]+'"'+(this.pageSize==n[s]?"selected":"")+">"+n[s]+"</option>";e.append(o)}t+=e.prop("outerHTML"),t+="<div>&nbsp;"+("itemsCount"==this.displayInfoType?"<span>共"+this.itemsCount+"条</span>&nbsp;":"<span>共"+this.pages+"页</span>&nbsp;")+"("+this.itemsCount+'条记录)<span>&nbsp;到&nbsp;<input type="text" class="page-num"/><button class="page-confirm">确定</button>&nbsp;页</span></div>'}else t="<div>&nbsp;"+("itemsCount"==this.displayInfoType?"<span>共"+this.itemsCount+"条</span>&nbsp;":"<span>共"+this.pages+"页</span>&nbsp;")+'<span>&nbsp;到&nbsp;<input type="text" class="page-num"/><button class="page-confirm">确定</button>&nbsp;页</span></div>';return t},updateConfig:function(t){t.pageSize&&(this.pageSize=t.pageSize)}}),function(t,e,n,s,o,i,a){if(e=e||1,n=n||1,n||(n=Math.ceil(o/s)),"object"!=typeof t)var r=$(t);else r=t;r.data("sui-pagination",""),r.pagination({pages:n,styleClass:["pagination-large","pagination-right"],showCtrl:!0,displayPage:6,pageSize:s,itemsCount:o,currentPage:e,onSelect:i}),r.pagination("updatePages",~~n,~~e),r.data("evt-init")||(r.on("change",".page-size-sel",function(){r.pagination("updateConfig",{pageSize:+this.value}),i(1)}),r.data("evt-init",1))}}),define("coupons",["core","service/pagin"],function(t,e){var n=15,s=function(t){n=t},o=function(n){var s={},i=$(".page-size-sel").val()||15;s.pagesize=i,s.page=n||1,s.trigger_title=$("#trigger_title").val(),s.trigger_state=$("#trigger_state").val(),s.trigger_code=$("#trigger_code").val();var a=layer.load(1,{shade:[.1,"#fff"]}),r=new Date;$.ajax({type:"POST",data:s,url:t.getHost()+"/coupon1/triggerList",success:function(t){new Date-r<1500?setTimeout(function(){layer.close(a)},1500-(new Date-r)):layer.close(a),$("#send_table").empty();var n=JSON.parse(t);if(1==n.status){var s=$("#send_list_templete").html(),u=doT.template(s),c=u(n);$("#send_table").html(c),e("#pagelsit",+n.result.current,n.result.total_pages,i,n.result.total_items,function(t){o(t)})}else $("#send_table").html("<tr><td colspan='6' style='text-align: center'>"+n.result.msg+"</td></tr>"),$(".sui-text-right").hide()}})};return{getSendList:o,setPageSize:s}}),require.config({paths:{core:"../lovejs/core",tools:"../lovejs/tools",coupons:"service/coupon1"}}),$(function(){require(["core"],function(t){t.doTinit(),t.ReConsole()});var t=window.location.pathname;switch(t){case"/coupon1/send_manager":initCoupon()}}),define("coupon_index",function(){});
