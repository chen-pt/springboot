function initHelpful(){require(["helpful"],function(e){e.showHelpful()})}function initQuestion(){require(["helpful"],function(e){AnswerEvents(),$(document).on("click","#btn-question",function(){e.showQuestion()})})}function select_pages(e,t){require(["helpful"],function(n){var a=$("#page_size").val();n.setPageSize(a),n.showHelpful(e,t,1),n.showAnswersList(e,t,1)})}function index_searchHelpful(){require(["helpful"],function(e){e.showHelpful("search","all",1)})}function initDetail(){require(["helpful"],function(e){e.showDetail(),e.showAnswersList()})}function initAnswer(){require(["helpful"],function(e){AnswerEvents(),$(document).on("click","#btn-answer",function(){e.showAnswer()})})}function AnswerEvents(){document.getElementById("input_file").addEventListener("change",NoticeNewHandleFileSelect,!1)}function NoticeNewHandleFileSelect(e){require(["helpful"],function(t){var n=t.newhandleFileSelect(e);KindEditor.ready(function(e){e.editor({allowFileManager:!0});e.insertHtml("#simple","<img src='"+n+"' />")})})}define("core",[],function(){function submitPwd(e){$.ajax({type:"POST",data:e,url:getHost()+"/member/updatePwd",success:function(e){var t=JSON.parse(e);console.log(t),t.status?(layer.msg("密码修改成功！"),$("#pwd-modal").modal("hide")):layer.msg("密码修改失败！")}})}var doTinit=function(){doT.templateSettings={evaluate:/\[\%([\s\S]+?)\%\]/g,interpolate:/\[\%=([\s\S]+?)\%\]/g,encode:/\[\%!([\s\S]+?)\%\]/g,use:/\[\%#([\s\S]+?)\%\]/g,define:/\[\%##\s*([\w\.$]+)\s*(\:|=)([\s\S]+?)#\%\]/g,conditional:/\[\%\?(\?)?\s*([\s\S]*?)\s*\%\]/g,iterate:/\[\%~\s*(?:\%\]|([\s\S]+?)\s*\:\s*([\w$]+)\s*(?:\:\s*([\w$]+))?\s*\%\])/g,varname:"it",strip:!0,append:!0,selfcontained:!1}},getHost=function(){var e=location.origin||location.protocol+"//"+location.hostname+(80==location.port?"":":"+location.port);return e},exeError=function(e,t,n,a){if("http"==e.type){var s="status:"+t.status+" state:"+t.readyState+" text:"+n+" err:"+JSON.stringify(a);e.desc=s}console.log("错误处理："+JSON.stringify(e))},formatDate=function(){Date.prototype.format=function(e){e||(e="yyyy-MM-dd hh:mm:ss");var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var n in t)new RegExp("("+n+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[n]:("00"+t[n]).substr((""+t[n]).length)));return e}},ReConsole=function(){window.console=window.console||function(){var e={};return e.log=e.warn=e.debug=e.info=e.error=e.time=e.dir=e.profile=e.clear=e.exception=e.trace=e.assert=function(){},e}()},isExitsFunction=function(funcName){try{if("function"==typeof eval(funcName))return!0}catch(e){}return!1},isExitsVariable=function(e){try{return"undefined"!=typeof e}catch(t){}return!1};return $(document).on("click","#branner .download",function(){try{localStorage.setItem("is_show",!0)}catch(e){}}),$(document).on("click","#upgrade-bar .sui-close",function(){try{localStorage.setItem("upgrade-version",CURRENT_VERSION)}catch(e){}}),$(document).on("shown","#pwd-modal",function(){$("#pwd-form").validate({success:function(e){var t=e.serializeArray();submitPwd(t)}})}),$(document).on("hidden","#pwd-modal",function(){$("#pwd-form")[0].reset()}),$(function(){$.ajax({type:"get",url:getHost()+"/helpful/upgrade",dataType:"json"}).done(function(e){return e.status&&e.result.items.length?($("#upgrade-bar").find(".upgrade-title").empty().append(e.result.items[0].title).end().show(),$("#upgrade").find(".upgrade-content").empty().append(e.result.items[0].content),void(200==e.result.items[0].tips_type&&$("#upgrade-bar").hide())):null})}),$(function(){$.ajax({type:"POST",url:getHost()+"/store/getGrcode",success:function(e){1!=e&&$("#grcode").attr("src",e)},error:function(e,t){console.log("status:"+e.status),console.log("state:"+e.readyState),console.log("text:"+t)}})}),{doTinit:doTinit,getHost:getHost,exeError:exeError,formatDate:formatDate,ReConsole:ReConsole,isExitsVariable:isExitsVariable,isExitsFunction:isExitsFunction}}),define("service/pagin",[],function(){return $.fn.pagination.Constructor.prototype=$.extend($.fn.pagination.Constructor.prototype,{_drawCtrl:function(){var e="";if(this.pageSize&&this.itemsCount){var t=$('<select class="page-size-sel"></select>'),n=[15,30,50,100];for(var a in n){var s='<option value="'+n[a]+'"'+(this.pageSize==n[a]?"selected":"")+">"+n[a]+"</option>";t.append(s)}e+=t.prop("outerHTML"),e+="<div>&nbsp;"+("itemsCount"==this.displayInfoType?"<span>共"+this.itemsCount+"条</span>&nbsp;":"<span>共"+this.pages+"页</span>&nbsp;")+"("+this.itemsCount+'条记录)<span>&nbsp;到&nbsp;<input type="text" class="page-num"/><button class="page-confirm">确定</button>&nbsp;页</span></div>'}else e="<div>&nbsp;"+("itemsCount"==this.displayInfoType?"<span>共"+this.itemsCount+"条</span>&nbsp;":"<span>共"+this.pages+"页</span>&nbsp;")+'<span>&nbsp;到&nbsp;<input type="text" class="page-num"/><button class="page-confirm">确定</button>&nbsp;页</span></div>';return e},updateConfig:function(e){e.pageSize&&(this.pageSize=e.pageSize)}}),function(e,t,n,a,s,i,o){if(t=t||1,n=n||1,n||(n=Math.ceil(s/a)),"object"!=typeof e)var l=$(e);else l=e;l.data("sui-pagination",""),l.pagination({pages:n,styleClass:["pagination-large","pagination-right"],showCtrl:!0,displayPage:6,pageSize:a,itemsCount:s,currentPage:t,onSelect:i}),l.pagination("updatePages",~~n,~~t),l.data("evt-init")||(l.on("change",".page-size-sel",function(){l.pagination("updateConfig",{pageSize:+this.value}),i(1)}),l.data("evt-init",1))}}),define("helpful",["core","service/pagin"],function(e,t){var n=function(a,s,i){var o={},l=$(".page-size-sel").val()||15;o.pageSize=l,o.pageno=i,o.status=s,"search"==a&&(o.actor_name=$("#actor_name").val(),o.has_answers=$("#has_answers").val());var r=layer.load(1,{shade:[.1,"#fff"]}),u=new Date;$.ajax({type:"POST",data:o,url:e.getHost()+"/helpful/getHelpful",success:function(e){new Date-u<1500?setTimeout(function(){layer.close(r)},1500-(new Date-u)):layer.close(r);var i=JSON.parse(e);if(i.status){var o=$("#list_template").html(),c=doT.template(o),p=c(i);$("#helpful").html(p),t("#pagelsit",+i.result.current,i.result.total_pages,l,i.result.total_items,function(e){n(a,s,e)}),$("#pagelsit").show()}else $("#helpful").html('<tr><td colspan="7"  style="text-align: center;">'+i.result.msg+"</td></tr>"),$("#pagelsit").hide()}}),console.log("展示")},a=function(){if(!$('[name="q_type"]:checked').val())return void layer.msg("请先选择“分类”。");if($("#q_title").val().length<5)return void layer.msg("请填写“问题”且不少于5个字符。");if(!editor.html())return void layer.msg("请填写“描述”。");var t={};t.q_type=$('[name="q_type"]:checked').val(),t.q_title=$("#q_title").val(),t.q_content=editor.html(),$.ajax({type:"POST",data:t,url:e.getHost()+"/helpful/getQuestion",success:function(e){var t=JSON.parse(e);t.status?layer.confirm("提交成功，谢谢！",{btn:["确定"]},function(){location.pathname="helpful/index"}):$.alert({title:"温馨提示!",body:t.result.msg})}})},s=function(){var t={};t.q_no=$("#detail_huifu").val(),$.ajax({type:"POST",data:t,url:e.getHost()+"/helpful/getDetail",success:function(e){var t=JSON.parse(e);t.status&&($("#tw_question").html(t.result.actor_name),$("#tw_store").html(t.result.actor_store_name?t.result.actor_store_name:"总店"),$("#tw_time").html(t.result.create_time),$("#tw_title").html(t.result.q_title),$("#tw_content").html(t.result.q_content))}})},i=function(n,a,s){var o={},l=$(".page-size-sel").val()||15;o.q_no=$("#detail_huifu").val(),o.pageSize=l,o.pageno=s,o.status=a;var r=layer.load(1,{shade:[.1,"#fff"]}),u=new Date;$.ajax({type:"POST",data:o,url:e.getHost()+"/helpful/getAnswersList",success:function(e){new Date-u<1500?setTimeout(function(){layer.close(r)},1500-(new Date-u)):layer.close(r);var s=JSON.parse(e);if(s.status){var o=$("#list_template").html(),c=doT.template(o),p=c(s);$("#detail").html(p),t("#pagelsit",+s.result.current,s.result.total_pages,l,s.result.total_items,function(e){i(n,a,e)})}else $("#detail").html('<table class="sui-table table-bordered-simple table-helpful"><tbody><tr><td colspan="3"  style="text-align: center;padding: 50px 0;">没有回复问题！</td></tr></tbody></table>')}}),console.log("展示")},o=function(){if(!editorhui.html())return void layer.msg("请先填写“回复”。");var t={};t.q_no=$("#reply_id").val(),t.q_content=editorhui.html(),$.ajax({type:"POST",data:t,url:e.getHost()+"/helpful/getAnswer",success:function(e){var t=JSON.parse(e);t.status?layer.alert("提交成功，谢谢！",{btn:["确定"]},function(){location.href="/helpful/detail"+location.search}):$.alert({title:"温馨提示!",body:t.result.msg})}})},l=function(t){for(var n,a="",s=t.target.files,i=0,o=0,l=0;n=s[l];l++)if(n.type.match("image.*")){var r=new FormData;r.append("ad_img_file",n),$.ajax({url:e.getHost()+"/helpful/upload_pic_ajax",type:"POST",async:!1,success:function(e){var t=JSON.parse(e);t&&t.status?(i++,a=t.result.imgsrc,o+i==s.length&&alert("本次选择"+s.length+"张图片，其中"+i+"张添加成功，"+o+"张添加失败！")):(o++,o+i==s.length&&alert("本次选择"+s.length+"张图片，其中"+i+"张添加成功，"+o+"张添加失败！"))},error:function(e){},data:r,cache:!1,contentType:!1,processData:!1})}return a};return{showHelpful:n,showAnswersList:i,showQuestion:a,newhandleFileSelect:l,showAnswer:o,showDetail:s}}),require.config({paths:{core:"../lovejs/core",tools:"../lovejs/tools",helpful:"service/helpful"}}),$(function(){require(["core"],function(e){e.doTinit(),e.ReConsole()});var e=window.location.pathname;switch(e){case"/helpful/index":initHelpful();break;case"/helpful/detail":initDetail();break;case"/helpful/question":initQuestion();break;case"/helpful/reply":initAnswer()}}),define("helpful_index",function(){});