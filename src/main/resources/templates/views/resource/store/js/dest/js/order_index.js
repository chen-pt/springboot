function show_text_num(){try{document.getElementById("seller_memo_num").innerHTML=document.getElementById("seller_memo").value.length}catch(e){}document.getElementById("cash-receipt-note-text-num").innerHTML=document.getElementById("cash-receipt-note").value.length}function initIndex(){require(["order"],function(e){$(document).on("click",".down_goods",function(){$(".beihuo1").html("不能备货"),$(".beihuo2").html("不能备货"),$(".beihuo").html("知道了，继续备货"),$(this).parent().find('[name="orderlist_length"]').val()>1&&($(".much_goods").removeClass("hide"),$(".single_goods").addClass("hide"),$(".number_beihuo").html($(this).parent().find('[name="orderlist_length"]').val()),$(".goods_name").html($(this).parent().find('[name="orderlist_goods"]').val())),$("#message_id").val($(this).parent().find("[name='message_id_down']").val());var e=$("#message_id").val();$(".tuikuan").attr("href","agreeRefund/initiative?tid="+e),$(document).on("click",".beihuo",function(){index_stocking(e)})}),$(document).on("click",".send_goods",function(){$(".beihuo1").html("不能发货"),$(".beihuo").html("知道了，继续发货"),$(".beihuo2").html("不能发货"),$(this).parent().find('[name="orderlist_length"]').val()>1&&($(".much_goods").removeClass("hide"),$(".single_goods").addClass("hide"),$(".number_beihuo").html($(this).parent().find('[name="orderlist_length"]').val()),$(".goods_name").html($(this).parent().find('[name="orderlist_goods"]').val())),$("#message_id").val($(this).parent().find("[name='message_id_down']").val());var e=$("#message_id").val();$(".tuikuan").attr("href","agreeRefund/initiative?tid="+e),$(document).on("click",".beihuo",function(){index_DeliveryOne(e)})})}),show_text_num(),$(document).on("click","#order_tabs li",function(){$(this).addClass("active").siblings().removeClass("active");var e=$(this).data("value");$("#trades_status").val(e),index_searchOrder()}),require(["order"],function(e){e.showAllOrder("default","all",1),load_cash_payment(e)})}function index_searchOrder(){require(["order"],function(e){e.showAllOrder("search","all",1)})}function index_stocking(e,t,a){$("#order_"+e).prop("checked",!0),require(["order"],function(a){a.batchStocking(t||"",e)})}function index_DeliveryOne(e){$("#order_"+e).prop("checked",!0),require(["order"],function(t){t.batchToDoor("index",e)})}function initDetail(){require(["core","order"],function(e,t){e.doTinit();var a=1;t.showDetail(a),$(document).on("click",".update_goods_batch_no",function(){$('#updateGoodsBatchNo [name="order_batch_no"]').val($(this).parent().find('[name="goods_batch_no"]').val()),$('#updateGoodsBatchNo [name="goods_id"]').val($(this).parent().find('[name="goods_id"]').val()),$('#updateGoodsBatchNo [name="order_id"]').val($(this).parent().find('[name="order_id"]').val())}),$(document).on("click",".save_goods_batch_no",function(){t.save_goods_batch_no()})})}function initTodoor(){require(["order"],function(e){e.showAllOrder("default","todoor",1),$(document).on("click",".down_goods",function(){$(".beihuo1").html("不能备货"),$(".beihuo2").html("不能备货"),$(".beihuo").html("知道了，继续备货"),$(this).parent().find('[name="orderlist_length"]').val()>1&&($(".much_goods").removeClass("hide"),$(".single_goods").addClass("hide"),$(".number_beihuo").html($(this).parent().find('[name="orderlist_length"]').val()),$(".goods_name").html($(this).parent().find('[name="orderlist_goods"]').val())),$("#message_id").val($(this).parent().find("[name='message_id_down']").val());var e=$("#message_id").val();$(".tuikuan").attr("href","agreeRefund/initiative?tid="+e),$(document).on("click",".beihuo",function(){todoor_batchStocking(e)})}),$(document).on("click",".send_goods",function(){$(".beihuo1").html("不能发货"),$(".beihuo").html("知道了，继续发货"),$(".beihuo2").html("不能发货"),$(this).parent().find('[name="orderlist_length"]').val()>1&&($(".much_goods").removeClass("hide"),$(".single_goods").addClass("hide"),$(".number_beihuo").html($(this).parent().find('[name="orderlist_length"]').val()),$(".goods_name").html($(this).parent().find('[name="orderlist_goods"]').val())),$("#message_id").val($(this).parent().find("[name='message_id_down']").val());var e=$("#message_id").val();$(".tuikuan").attr("href","agreeRefund/initiative?tid="+e),$(document).on("click",".beihuo",function(){todoor_Delivery(e)})})})}function todoor_SearchOrder(){require(["order"],function(e){e.showAllOrder("search","todoor",1)})}function todoor_Checkitem(e){require(["order"],function(t){t.checkAll(e)})}function todoor_singleCheck(e){$("#checkall").prop("checked",!1)}function todoor_Confirmselect(){require(["order"],function(e){e.batchConfirm(),e.showAllOrder("default","todoor",1)})}function todoor_Confirm(e,t){$("#order_"+e).prop("checked",!0),require(["order"],function(e){t=t?1:0,e.batchConfirm(t),e.showAllOrder("default","todoor",1)})}function todoor_batchStocking(e){require(["order"],function(t){t.batchStocking("todoor",e)})}function todoor_stocking(e){$("#order_"+e).prop("checked",!0),require(["order"],function(e){e.batchStocking("todoor")})}function todoor_Delivery(e){require(["order"],function(t){t.batchToDoor("todoor",e)})}function todoor_DeliveryOne(e){$("#order_"+e).prop("checked",!0),require(["order"],function(e){e.batchToDoor("todoor")})}function initSince(){require(["order"],function(e){e.showAllOrder("default","since",1),authcodeDown(e),$(document).on("click",".down_goods",function(){$(".beihuo1").html("不能备货"),$(".beihuo2").html("不能备货"),$(".beihuo").html("知道了，继续备货"),$(this).parent().find('[name="orderlist_length"]').val()>1&&($(".much_goods").removeClass("hide"),$(".single_goods").addClass("hide"),$(".number_beihuo").html($(this).parent().find('[name="orderlist_length"]').val()),$(".goods_name").html($(this).parent().find('[name="orderlist_goods"]').val())),$("#message_id").val($(this).parent().find("[name='message_id_down']").val());var e=$("#message_id").val();$(".tuikuan").attr("href","agreeRefund/initiative?tid="+e),$(document).on("click",".beihuo",function(){todoor_batchStocking(e)})}),$(document).on("click",".ti_goods",function(){$(".beihuo1").html("不能提货"),$(".beihuo2").html("不能提货"),$(".beihuo").html("知道了，继续提货"),$(this).parent().find('[name="orderlist_length"]').val()>1&&($(".much_goods").removeClass("hide"),$(".single_goods").addClass("hide"),$(".number_beihuo").html($(this).parent().find('[name="orderlist_length"]').val()),$(".goods_name").html($(this).parent().find('[name="orderlist_goods"]').val())),$("#message_id").val($(this).parent().find("[name='message_id_down']").val());var e=$("#message_id").val();$(".tuikuan").attr("href","agreeRefund/initiative?tid="+e),$(document).on("click",".beihuo",function(){var t=$(this).data("value");$("#since").val(t),$("#trades_id").val(e),$("#authcode-modal").modal("show"),$("#auth_code").val("")})})})}function since_SearchOrder(){require(["order"],function(e){e.showAllOrder("search","since",1)})}function since_Checkitem(e){require(["order"],function(t){t.checkAll(e)})}function since_singleCheck(e){$("#checkall").prop("checked",!1)}function since_batchStocking(){require(["order"],function(e){e.batchStocking("since")})}function since_stocking(e){$("#order_"+e).prop("checked",!0),require(["order"],function(e){e.batchStocking("since")})}function initBuying(){require(["order"],function(e){e.showAllOrder("default","buying",1),load_cash_payment(e)})}function buying_SearchOrder(){require(["order"],function(e){e.showAllOrder("search","buying",1)})}function buying_confirmReceipt(e){require(["order"],function(t){$.confirm({body:"您确认用户已提货了吗?",okHide:function(){t.confirmReceipt(e)}})})}function initDeliverypay(){require(["order"],function(e){e.showAllOrder("default","all",1,180,"110,130,140,160,170,180"),$(document).on("click",".down_goods",function(){$(".beihuo1").html("不能备货"),$(".beihuo2").html("不能备货"),$(".beihuo").html("知道了，继续备货"),$(this).parent().find('[name="orderlist_length"]').val()>1&&($(".much_goods").removeClass("hide"),$(".single_goods").addClass("hide"),$(".number_beihuo").html($(this).parent().find('[name="orderlist_length"]').val()),$(".goods_name").html($(this).parent().find('[name="orderlist_goods"]').val())),$("#message_id").val($(this).parent().find("[name='message_id_down']").val());var e=$("#message_id").val();$(".tuikuan").attr("href","agreeRefund/initiative?tid="+e),$(document).on("click",".beihuo",function(){var t="deliverypay";deliverypay_stocking(e,t)})}),$(document).on("click",".send_goods",function(){$(".beihuo1").html("不能发货"),$(".beihuo").html("知道了，继续发货"),$(".beihuo2").html("不能发货"),$(this).parent().find('[name="orderlist_length"]').val()>1&&($(".much_goods").removeClass("hide"),$(".single_goods").addClass("hide"),$(".number_beihuo").html($(this).parent().find('[name="orderlist_length"]').val()),$(".goods_name").html($(this).parent().find('[name="orderlist_goods"]').val())),$("#message_id").val($(this).parent().find("[name='message_id_down']").val());var e=$("#message_id").val();$(".tuikuan").attr("href","agreeRefund/initiative?tid="+e),$(document).on("click",".beihuo",function(){var t="deliverypay";deliverypay_DeliveryOne(e,t)})})})}function deliverypay_SearchOrder(){require(["order"],function(e){e.showAllOrder("search","all",1,180,"110,130,140,160,170,180")})}function deliverypay_Checkitem(e){require(["order"],function(t){t.checkAll(e)})}function deliverypay_singleCheck(e){$("#checkall").prop("checked",!1)}function deliverypay_batchStocking(e){require(["order"],function(t){t.batchStocking(e)})}function deliverypay_Delivery(e){require(["order"],function(t){t.batchToDoor(e)})}function deliverypay_stocking(e,t){$("#order_"+e).prop("checked",!0),require(["order"],function(e){e.batchStocking(t)})}function deliverypay_DeliveryOne(e,t){$("#order_"+e).prop("checked",!0),require(["order"],function(e){e.batchToDoor(t)})}function load_cash_payment(e){$(function(){$("#xxxx-form").validate({success:function(){e.showPayTradesByCashReceipts()}})})}function initCreate(){require(["order"],function(e){e.showClerk()})}function create_searchGood(){var e=$("#item_title").val();""!=e&&require(["core","create"],function(e,t){t.searchGoods()})}function create_Sureuse(e,t){$("#item_title").val(""),$("#search_lab").css("display","none"),require(["create"],function(t){t.addShopCar(e),t.showShopCar()})}function create_Clear(){$("#item_title").val("")}function create_changeShopCar(e,t){require(["create"],function(a){var o=a.changeShopCar("update",e,t);$("#nums_"+o.product_id).val(o.product_num),$("#item_total_"+o.product_id).html((~~o.product_price*~~o.product_num/100).toFixed(2)),create_caluShopcar()})}function create_inputChange(e,t){require(["create"],function(a){var o=$("#control_"+e).val(),r=a.ValidateinputChange(t,o),n=a.changeShopCar("set",e,r);$("#nums_"+n.product_id).val(n.product_num),$("#item_total_"+n.product_id).html((~~n.product_price*~~n.product_num/100).toFixed(2)),create_caluShopcar()})}function create_delShopCar(e){require(["create"],function(t){t.delShopCar(e),t.showShopCar()})}function create_caluShopcar(){require(["create"],function(e){var t=e.CalculationShopCar();$("#item_num").html(t.item_num),$("#item_total").html((t.item_total/100).toFixed(2))})}function create_Calculate(){require(["create","tools"],function(e,t){var a=$("#username").val();return t.validate("mobile",a,null)?void(Object.keys(e.shopcar).length>0?($("#username").attr("disabled","disabled"),$("#item_title").attr("disabled","disabled"),$("#sotore_worker").attr("disabled","disabled"),$("#clerk_list").addClass("disabled"),e.showShopCar("shopcarcalculate_template"),e.calculate(a,0)):$.alert({title:"温馨提示!",backdrop:"static",body:"请先添加商品哦！"})):void $.alert({title:"温馨提示!",backdrop:"static",body:"手机号码格式不正确！"})})}function createIntegralChange(){require(["create"],function(e){var t=$("#username").val(),a=Number($("#integral_use").val()),o=Number($("#control_integral").val());isNaN(a)?a=0:a>o&&(a=o),e.calculate(t,a)})}function create_Commit(){require(["core","create"],function(e,t){var a=$("#username").val(),o=$("#sotore_worker").val(),r=$("#integral_use").val(),n=t.commitOrder(a,o,r);n&&(window.location.href=e.getHost()+"/order/buying")})}function create_checkUser(){var e=$("#username").val();require(["create"],function(t){t.checkUser(e)})}function initStocking(){require(["order"],function(e){e.showStocking()})}function stocking_completeStock(){require(["order"],function(e){e.flushStocking()})}function initDelivery(){require(["order"],function(e){e.showStocking(),e.showClerk()})}function delviery_clerkselect(e){console.log("手机:"+e),$("#clerk_mobile").html(e)}function deviery_send(){require(["order"],function(e){e.goToDoor()})}function initUserdelivery(){}function userdelivery_checkCode(){require(["order","tools"],function(e,t){var a=$("#dely_code").val();t.validate("member",a,null)?e.userTakedelivery(a):$.alert({title:"温馨提示!",body:"提货码输入有误，请重新输入！"})})}function order_message(){require(["core"],function(e){var t={};t.time=1,$.ajax({type:"POST",data:t,url:e.getHost()+"/order/orderMessage",dataType:"json",success:function(e){if(e.status){if(navigator.userAgent.indexOf("Firefox")>0){var a='<audio autoplay="autoplay" src="'+SOURCE_URL+'/store/static/mp3/order.mp3"> </audio>';$("#music").empty().prepend(a)}else $("#music").empty().prepend('<Embed id="music_play" src="'+SOURCE_URL+'/store/static/mp3/order.mp3" width="0" height="0" AUTOSTART="TURE" LOOP="FALSE"></Embed>');$(".modal-content").parents("[role=dialog]").modal("hide"),$.alert({title:"订单消息",backdrop:"static",okBtn:"好的",body:'<h2 class="sui-text-danger">您有新订单，请及时处理！</h2>'})}setTimeout("order_message()",60*t.time*1e3)}})})}function buying_sendCode(e){require(["order"],function(t){t.sendSinceCode(e)})}function initCountTrades(){require(["order"],function(e){e.showCountOrder(1),$(document).on("click","#trade-count-search",function(){e.showCountOrder(1)})})}function sellerBtn(){require(["order"],function(e){e.showseller()})}function bar_Code_search(){require(["core","create"],function(e,t){var a=$("#bar_code").val();return/^\d+$/.test(a)?void $.ajax({url:e.getHost()+"/order/getProductBybarCode",type:"post",data:{bar_code:a},dataType:"json"}).done(function(e){e.status&&e.result.items.length?(t.addShopCar(e.result.items[0].goods_id),t.showShopCar()):alert("没有找到对应的商品")}):void alert("请输入有效的条形码，条形码为纯数字组合")})}function refreshStatus(){var e=$("#tradeid").val();require(["core"],function(t){$.ajax({url:t.getHost()+"/order/refreshTradesPayStatus",type:"post",dataType:"json",data:{trades_id:e}}).done(function(e){e.status?location.reload():$.alert({body:"刷新失败，订单还未付款，请稍后再试"})})})}function initRefund(){function e(e){$("#real_refund_money,#refund_cash,#refund_health_insurance").autoNumeric("init",{aSep:0,mDec:null,aPad:2}),$("#img-url").on("load",function(){var t=this.contentDocument.body.innerHTML;try{t=JSON.parse(t)}catch(a){t={status:!1,result:{msg:"上传失败"}}}t.status?e.addCe(t.result.imgurl):layer.alert(t.result.msg)})}require(["core","refund"],function(t,a){a.init(),$(function(){e(a),$.validate.setRule("express",function(e,t,a){return/^\d{6,20}$/.test(e)},"请输入正确的快递单号"),$.validate.setRule("min",function(e,t,a){return!(a>e)},"退款金额不能小于0.01元"),$("#refund-form").validate({success:function(e){a.handleRefund(e.serializeArray())}})})}),$(document).on("submit","#temp-file-form",function(e){console.log(e)})}function reportDown(){require(["order"],function(e){e.showreportDown()})}function authcodeDown(e){$(function(){$("#authcode-form").validate({success:function(){e.showconfirmReceipt()}})})}define("core",[],function(){function submitPwd(e){$.ajax({type:"POST",data:e,url:getHost()+"/member/updatePwd",success:function(e){var t=JSON.parse(e);console.log(t),t.status?(layer.msg("密码修改成功！"),$("#pwd-modal").modal("hide")):layer.msg("密码修改失败！")}})}var doTinit=function(){doT.templateSettings={evaluate:/\[\%([\s\S]+?)\%\]/g,interpolate:/\[\%=([\s\S]+?)\%\]/g,encode:/\[\%!([\s\S]+?)\%\]/g,use:/\[\%#([\s\S]+?)\%\]/g,define:/\[\%##\s*([\w\.$]+)\s*(\:|=)([\s\S]+?)#\%\]/g,conditional:/\[\%\?(\?)?\s*([\s\S]*?)\s*\%\]/g,iterate:/\[\%~\s*(?:\%\]|([\s\S]+?)\s*\:\s*([\w$]+)\s*(?:\:\s*([\w$]+))?\s*\%\])/g,varname:"it",strip:!0,append:!0,selfcontained:!1}},getHost=function(){var e=location.origin||location.protocol+"//"+location.hostname+(80==location.port?"":":"+location.port);return e},exeError=function(e,t,a,o){if("http"==e.type){var r="status:"+t.status+" state:"+t.readyState+" text:"+a+" err:"+JSON.stringify(o);e.desc=r}console.log("错误处理："+JSON.stringify(e))},formatDate=function(){Date.prototype.format=function(e){e||(e="yyyy-MM-dd hh:mm:ss");var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var a in t)new RegExp("("+a+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[a]:("00"+t[a]).substr((""+t[a]).length)));return e}},ReConsole=function(){window.console=window.console||function(){var e={};return e.log=e.warn=e.debug=e.info=e.error=e.time=e.dir=e.profile=e.clear=e.exception=e.trace=e.assert=function(){},e}()},isExitsFunction=function(funcName){try{if("function"==typeof eval(funcName))return!0}catch(e){}return!1},isExitsVariable=function(e){try{return"undefined"!=typeof e}catch(t){}return!1};return $(document).on("click","#branner .download",function(){try{localStorage.setItem("is_show",!0)}catch(e){}}),$(document).on("click","#upgrade-bar .sui-close",function(){try{localStorage.setItem("upgrade-version",CURRENT_VERSION)}catch(e){}}),$(document).on("shown","#pwd-modal",function(){$("#pwd-form").validate({success:function(e){var t=e.serializeArray();submitPwd(t)}})}),$(document).on("hidden","#pwd-modal",function(){$("#pwd-form")[0].reset()}),$(function(){$.ajax({type:"get",url:getHost()+"/helpful/upgrade",dataType:"json"}).done(function(e){return e.status&&e.result.items.length?($("#upgrade-bar").find(".upgrade-title").empty().append(e.result.items[0].title).end().show(),$("#upgrade").find(".upgrade-content").empty().append(e.result.items[0].content),void(200==e.result.items[0].tips_type&&$("#upgrade-bar").hide())):null})}),$(function(){$.ajax({type:"POST",url:getHost()+"/store/getGrcode",success:function(e){1!=e&&$("#grcode").attr("src",e)},error:function(e,t){console.log("status:"+e.status),console.log("state:"+e.readyState),console.log("text:"+t)}})}),{doTinit:doTinit,getHost:getHost,exeError:exeError,formatDate:formatDate,ReConsole:ReConsole,isExitsVariable:isExitsVariable,isExitsFunction:isExitsFunction}}),define("service/pagin",[],function(){return $.fn.pagination.Constructor.prototype=$.extend($.fn.pagination.Constructor.prototype,{_drawCtrl:function(){var e="";if(this.pageSize&&this.itemsCount){var t=$('<select class="page-size-sel"></select>'),a=[15,30,50,100];for(var o in a){var r='<option value="'+a[o]+'"'+(this.pageSize==a[o]?"selected":"")+">"+a[o]+"</option>";t.append(r)}e+=t.prop("outerHTML"),e+="<div>&nbsp;"+("itemsCount"==this.displayInfoType?"<span>共"+this.itemsCount+"条</span>&nbsp;":"<span>共"+this.pages+"页</span>&nbsp;")+"("+this.itemsCount+'条记录)<span>&nbsp;到&nbsp;<input type="text" class="page-num"/><button class="page-confirm">确定</button>&nbsp;页</span></div>'}else e="<div>&nbsp;"+("itemsCount"==this.displayInfoType?"<span>共"+this.itemsCount+"条</span>&nbsp;":"<span>共"+this.pages+"页</span>&nbsp;")+'<span>&nbsp;到&nbsp;<input type="text" class="page-num"/><button class="page-confirm">确定</button>&nbsp;页</span></div>';return e},updateConfig:function(e){e.pageSize&&(this.pageSize=e.pageSize)}}),function(e,t,a,o,r,n,i){if(t=t||1,a=a||1,a||(a=Math.ceil(r/o)),"object"!=typeof e)var s=$(e);else s=e;s.data("sui-pagination",""),s.pagination({pages:a,styleClass:["pagination-large","pagination-right"],showCtrl:!0,displayPage:6,pageSize:o,itemsCount:r,currentPage:t,onSelect:n}),s.pagination("updatePages",~~a,~~t),s.data("evt-init")||(s.on("change",".page-size-sel",function(){s.pagination("updateConfig",{pageSize:+this.value}),n(1)}),s.data("evt-init",1))}}),define("order",["core","service/pagin"],function(e,t){var a=15,o=function(e){a=e},r=function(a,o,s,l,d){var c={},u=$(".page-size-sel").val()||15;"search"==a&&(c.id=$("#tid").val(),c.phone=$("#phone").val(),c.start_time=$("#date_start").val(),c.end=$("#date_end").val(),c.start_time=$("#start_time").val(),c.end_time=$("#end_time").val(),c.trades_rank=$("#trades_rank").val(),c.pay_style=$("#pay_style").val(),c.logistics_status=$("#logistics_status").val()),c.status=o,c.pageSize=u,c.pageno=s,c.trades_status=d||$("#trades_status").val(),c.clerk_invitation_code=$("#clerk_invitation_code").val(),c.post_style=l||$("#post_style").val(),$("#order_tabs").find('[data-value="'+c.trades_status+'"]').addClass("active").siblings().removeClass("active");var p=layer.load(1,{shade:[.1,"#fff"]}),h=new Date;$.ajax({type:"POST",data:c,url:e.getHost()+"/order/getOrders",success:function(e){new Date-h<1500?setTimeout(function(){layer.close(p)},1500-(new Date-h)):layer.close(p);var n=JSON.parse(e);if(1==n.status){for(var s=0,c=n.result.items.length;c>s;s++){n.result.items[s].except_num=0,n.result.items[s].except_goods="";for(var m=0,f=n.result.items[s].order_list.length;f>m;m++)1!=n.result.items[s].order_list[m].goods_status&&(n.result.items[s].except_num+=1,n.result.items[s].except_goods=n.result.items[s].order_list[m].goods_title)}n.dateText=function(e){var t=new Date,a=new Date,o="";switch(+e.trades_status){case 110:t=new Date(e.create_time.replace(/-/g,"/")),o="已下单";break;case 120:if(120==e.shipping_status&&180==e.post_style)return"";if(""==e.pay_style&&160==e.post_style){t=new Date(e.create_time.replace(/-/g,"/")),o="已下单";break}t=new Date(e.pay_time.replace(/-/g,"/")),o="已付款";break;case 190:t=new Date(e.refund_time.replace(/-/g,"/")),o="申请退款";break;case 130:t=new Date(e.consign_time.replace(/-/g,"/")),o="已发货";break;case 150:return"";default:return e.create_time}var r=Math.abs(a-t),n=Math.floor(r/864e5),i=Math.floor(r/36e5)%24,s=Math.floor(r/6e4%60);return o+(n?n+"天":"")+(i?i+"小时":"")+(s+"分")};var g=$("#list_templete").html(),v=doT.template(g),_=v(n);$("#order_list").html(_),t("#pagelsit",+n.result.current,n.result.total_pages,u,n.result.total_items,function(e){r(a,o,e,l,d)}),"todoor"!=o&&"since"!=o&&"all"!=o||i(n.result.stocks),$("#pagelsit").show()}else $("#order_list").html('<div class="introjs-content">'+n.result.msg+"</div>"),$("#pagelsit").hide();$('[data-toggle="tooltip"]').tooltip()},error:function(t,a,o){var r={action:"所有订单",type:"http",desc:""};e.exeError(r,t,a,o)}}),n()},n=function(){$.ajax({type:"POST",data:{},url:e.getHost()+"/order/popOrder",success:function(e){console.log("order pop :"+e);var t=JSON.parse(e);t.status?(t.result.door_delivery>0?$("#delivery").css("display","block").html(t.result.door_delivery):$("#delivery").css("display","none"),t.result.stores_logistics>0?$("#selftaken").css("display","block").html(t.result.stores_logistics):$("#selftaken").css("display","none"),t.result.direct_purchase>0?$("#directbuy").css("display","block").html(t.result.direct_purchase):$("#directbuy").css("display","none"),t.result.goods_prebook>0?$("#prebook").css("display","block").html(t.result.goods_prebook):$("#prebook").css("display","none")):$.alert({title:"温馨提示!",body:t.result.msg})},error:function(t,a,o){var r={action:"订单提示",type:"http",desc:""};e.exeError(r,t,a,o)}})},i=function(e){for(var t=0,a=e.length;a>t;t++)$("#todoor_"+e[t].trades_id).html(e[t].stockup_id)},s=function(t){var a={};a.id=$("#tradeid").val(),a.has_comment=t||0,$.ajax({type:"POST",data:a,url:e.getHost()+"/order/getOrder",success:function(e){var t=JSON.parse(e);if(1==t.status){var a=$("#detail_template").html(),o=doT.template(a),r=o(t);$("#detail").html(r);var n=t.result.trades_information.seller_flag;$(".flag-box").find('input[value="'+n+'"]').attr("checked",!0),show_text_num()}else $.alert({title:"温馨提示!",body:t.result.msg})}})},l=function(t){var a=[];if($(":checkbox").each(function(){if($(this).is(":checked")&&"0"!=$(this).val()){var e=$(this).val(),t=$("#tradestatus_"+e).val();130==t||120==t?a.push(e):$(this).prop("checked",!1)}}),console.log("选择的订单："+JSON.stringify(a)),a.length>0){var o={trades:JSON.stringify(a),logistics:t};$.ajax({type:"POST",data:o,url:e.getHost()+"/order/batchReceipt",success:function(e){console.log("order batchReceipt :"+e);var t=JSON.parse(e);if(t.status)$.alert({title:"温馨提示!",body:"操作成功！",okHide:function(){window.location.reload()}});else{for(var a="<table  border='1' cellpadding='1' cellspacing='0'><tr><td>订单号</td><td>失败原因</td></tr>",o=0,r=t.result.length;r>o;o++){var n="<tr><td>"+t.result[o].trade_id+"</td><td>"+t.result[o].msg+"</td></tr>";a+=n}a+="</table>",console.log("body:"+a),$.alert({title:"失败提示!",body:a})}}})}else $.alert({title:"温馨提示!",body:"未选择任何订单或所选订单还未完成送货！"})},d=function(e){var t=$("#"+e).is(":checked");t?$(":checkbox").each(function(){var e=$(this).attr("disabled");"disabled"!=e&&$(this).prop("checked",!0)}):$(":checkbox").each(function(){$(this).prop("checked",!1)})},c=function(t,a,o){var r=a||"";$(":checkbox").each(function(){if($(this).is(":checked")&&"0"!=$(this).val()){var e=$(this).val();u(e,110)?r+=e+",":$(this).prop("checked",!1)}}),console.log("批量备货："+r),r.length>0?window.location.href=e.getHost()+"/order/stocking#"+t+"&"+r:$.alert({title:"温馨提示!",body:"未选择任何订单或所选订单已完成备货！"})},u=function(e,t){var a=$("#status_"+e).val(),o=$("#tradestatus_"+e).val();return parseInt(o)<=120&&(parseInt(t)==parseInt(a)||110==t&&"null"==a)},p=function(){var t=window.location.hash?window.location.hash:"#no";t=t.substr(1,t.length),window.location.hash=t,orders=t.split("&");var a=orders[1];if(a.length>0){var o={tradeids:a};$.ajax({type:"POST",data:o,async:!1,url:e.getHost()+"/order/getStockup",success:function(t){var a=JSON.parse(t);if(a.status){a.module=orders[0];var o=$("#list_template").html(),r=doT.template(o),n=r(a);if($("#stock_list").html(n),1==a.result.length&&a.result[0].display){$("#express_tpl").css("display","block");var i=new Array(0,1,2,3,4,5,6,7,8),s=parseInt(a.result[0].logistics_status);if(-1==$.inArray(s,i))var l='<button class="sui-btn btn-xlarge btn-warning" style="margin-top: 15px;" id="express_btn">通知取货</button>';else var l='<button class="sui-btn btn-xlarge btn-warning" style="margin-top: 15px;" disabled="disabled" id="express_btn">通知取货</button>';$("#button").append(l)}if("since"==a.module||"indexsince"==a.module){e.formatDate();var d=new Date,c=d.format("yyyy-MM-dd hh:mm"),u=new Date(d.getTime()+6048e5).format("yyyy-MM-dd hh:mm");console.log("now:"+d+"  start:"+c+" end:"+u),$("#date_start").val(c),$("#date_end").val(u)}a.result[0]&&$("#selectShipping-Modal").on("show",function(){var t=$.ajax({url:e.getHost()+"/lib/selectShipping",dataType:"json"}),a=$("#log_id");return function(){t.done(function(e){a.empty().append('<option value="">请选择</option>'),e.status&&$(e.result).each(function(e,t){var o='<option value="$log_id">$name</option>'.replace("$name",t.name).replace("$log_id",t.log_id);a.append(o)})})}}()),"todoor"!=a.module&&"indextodoor"!=orders[0]&&"buying"!=a.module&&"indexbuying"!=a.module||$("#selectShipping-warp").show(),$(document).on("click","#set-shipping",function(){var t=$("#select-shipping-form").serializeArray();if(!$("#log_id").val())return void layer.msg("请选择物流公司");var a=$("#log_num").val();return a?$.isNumeric(a)?void $.ajax({url:e.getHost()+"/order/setShipping",type:"post",data:t,dataType:"json"}).done(function(t){t&&t.status?($("#selectShipping-Modal").modal("hide"),layer.alert(t.result.msg,{time:3e3,end:function(){window.location.href=e.getHost()+"/order/"+(orders[0]||"todoor")}})):layer.alert(t.result.msg)}):void layer.msg("运单号码必须全部是数字"):void layer.msg("请输入运单号码")})}else $.alert({title:"温馨提示!",body:a.result.msg})}})}},h=function(){var t=window.location.hash?window.location.hash:"#no";t=t.substr(1,t.length),window.location.hash=t,orders=t.split("&");var a=orders[1];if(a.length>0){var o={tradeids:a},r={flag:!0,msg:""};o.status=orders[0],"since"!=orders[0]&&"indexsince"!=orders[0]||(o.start=$("#date_start").val(),o.end=$("#date_end").val(),""==o.start?(r.flag=!1,r.msg="开始提货时间不能为空！"):""==o.end&&(r.flag=!1,r.msg="截止提货时间不能为空！")),r.flag?$.ajax({type:"POST",data:o,async:!1,url:e.getHost()+"/order/batchStock",success:function(t){var a=JSON.parse(t);if(a.status){var o=orders[0];"index"!=o&&"since"!=o||(o="index"),o?window.location.href=e.getHost()+"/order/"+o:window.location.href=e.getHost()+"/order/index"}else $.alert({title:"温馨提示!",body:a.result.msg})}}):$.alert({title:"温馨提示!",body:r.msg})}},m=function(){$.ajax({type:"POST",data:{},url:e.getHost()+"/order/getStoreClerk",success:function(t){var a=JSON.parse(t);if(a.status){var o=$("#clerk_template").html(),r=doT.template(o),n=r(a);$("#clerk_select").html(n)}else"8561"==a.result.code?$.confirm({title:"温馨提示!",body:"本店还没有店员，请添加店员哦！",okBtn:"立即添加",cancelBtn:"稍后再说",okHide:function(){window.location.href=e.getHost()+"/clerk/add"}}):$.alert({title:"温馨提示!",body:a.result.msg}),$("#clerk_select").html('本店还没有店员，请<a href="'+e.getHost()+'/clerk/add">添加店员</a>')}})},f=function(t,a,o){var r=a||"";$(":checkbox").each(function(){if($(this).is(":checked")&&"0"!=$(this).val()){var e=$(this).val();u(e,120)?r+=e+",":$(this).prop("checked",!1)}}),console.log("批量备货："+r),r.length>0?window.location.href=e.getHost()+"/order/delivery#"+t+"&"+r:$.alert({title:"温馨提示!",body:"未选择任何订单或所选订单状态不正确，不能进行送货操作！"})},g=function(){var t=window.location.hash?window.location.hash:"#no";t=t.substr(1,t.length),window.location.hash=t,orders=t.split("&");var a=orders[1];if(a.length>0){var o={tradeids:a};o.clerkid=$("#sotore_worker").val(),"undefined"!=typeof o.clerkid&&-1!=o.clerkid?$.ajax({type:"POST",data:o,async:!1,url:e.getHost()+"/order/batchTodoor",success:function(t){var a=JSON.parse(t);a.status?window.location.href=e.getHost()+"/order/"+orders[0]:$.alert({title:"温馨提示!",body:a.result.msg})}}):$.alert({title:"温馨提示!",body:"请选择送货员！"})}},v=function(t){var a={};a.tradesid=t,$.ajax({type:"POST",data:a,async:!1,url:e.getHost()+"/order/sendSinceCode",success:function(e){var t=JSON.parse(e);t.status?$.alert({title:"温馨提示!",body:"发送成功！"}):$.alert({title:"温馨提示!",body:t.result.msg})}})},_=function(t){var a={};a.tradesid=t,$.ajax({type:"POST",data:a,url:e.getHost()+"/order/confirmReceipt",success:function(t){var a=JSON.parse(t);a.status?($.alert({title:"温馨提示!",body:"交易已成功！"}),window.location.href=e.getHost()+"/order/buying"):$.alert({title:"温馨提示!",body:a.result.msg})}})},b=function(t,a){var o={};o.code=t,o.has_pick=a,$.ajax({type:"POST",data:o,async:!1,url:e.getHost()+"/order/checkSinceCode",success:function(e){var o=JSON.parse(e);if(o.status){o.result.except_goods=0,$.each(o.result.order_list,function(e,t){1!=t.goods_status&&(o.result.except_goods+=1,o.result.except_name=t.goods_title)});var r=$("#delivery_template").html(),n=doT.template(r);o.has_pick=a;var i=n(o);$("#item_list").html(i),a||120!=o.result.trades_information.trades_status?$("#pick-goods-btn").hide():o.result.except_goods>1||1==o.result.except_goods&&o.result.order_list.length>1?($(".single_goods").addClass("hide"),$(".much_goods").removeClass("hide"),$(".goods_name").html(o.result.except_name),$(".number_beihuo").html(o.result.except_goods),$("#pick-goods-btn").show().on("click",function(){$("#message_goods").modal("show"),$(".beihuo1").html("不能提货"),$(".beihuo2").html("不能提货"),$(".beihuo").html("知道了，继续提货"),$(".tuikuan").attr("href","agreeRefund/initiative?tid="+o.result.trades_information.trades_id),$(document).on("click",".beihuo",function(){b(t,1)})})):o.result.except_goods>0?$("#pick-goods-btn").show().on("click",function(){$("#message_goods").modal("show"),$(".beihuo1").html("不能提货"),$(".beihuo2").html("不能提货"),$(".beihuo").html("知道了，继续提货"),$(".tuikuan").attr("href","agreeRefund/initiative?tid="+o.result.trades_information.trades_id),$(document).on("click",".beihuo",function(){b(t,1)})}):$("#pick-goods-btn").show().on("click",function(){b(t,1)})}else $.alert({title:"温馨提示!",body:"提货码有误!"})}})},y=function(a){var o=$("#order-search-form").serializeArray(),r=$(".page-size-sel").val()||15;o.push({name:"pageno",value:a}),o.push({name:"pagesize",value:r});var n=layer.load(1,{
shade:[.1,"#fff"]}),i=new Date;$.ajax({url:e.getHost()+"/order/getCountOrderList",type:"post",data:o,dataType:"json"}).success(function(e){new Date-i<1500?setTimeout(function(){layer.close(n)},1500-(new Date-i)):layer.close(n),e.conv_post_style=function(e){var t={110:"包邮",120:"平邮",130:"快递",140:"EMS",150:"送货上门",160:"上门自提",170:"门店直销","default":"其它"};return t[e||"default"]},e.conv_pay_style=function(e){var t={ali:"支付宝",wx:"微信",bil:"快钱","default":"无"};return t[e||"default"]},e.conv_trades_source=function(e){var t={110:" 网站",120:"微信",130:"app",140:"直购",9999:"其它","default":"无"};return t[e||"default"]};var a=$("#trade-list-temp").html();a=doT.template(a)(e),$("#trade-list").empty().append(a),t("#pagein",+e.result.current,e.result.total_pages,r,e.result.total_items,function(e,t){y(e,t)}),e.status?$("#pagein").show():$("#pagein").hide()}).fail(function(){})},k=function(){var t=$('#updateGoodsBatchNo [name="order_batch_no"]').val(),a=$('#updateGoodsBatchNo [name="goods_id"]').val(),o=$('#updateGoodsBatchNo [name="order_id"]').val(),r={};r.goods_batch_no=t,r.goods_id=a,r.order_id=o;var n=e.getHost()+"/order/updateOrdersGoods";$.post(n,r,function(e){var t=JSON.parse(e);t.status?(alert("保存成功！"),$("#updateGoodsBatchNo").modal("hide")):(alert("保存成功！"),$("#updateGoodsBatchNo").modal("hide")),window.location.reload()})},w=function(){var t={};return t.trades_id=$("#tradeid").val(),t.seller_flag=$('[name="seller_flag"]:checked').val(),t.seller_memo=$("#seller_memo").val(),t.seller_memo?t.seller_flag?void $.ajax({type:"POST",data:t,url:e.getHost()+"/order/setSeller",success:function(e){var t=JSON.parse(e);t.status?layer.msg("提交成功，谢谢！",function(){var e=$(".sui-pagination li.active a").html();r("default","all",e),$("#seller-modal").modal("hide")}):layer.msg("提交失败！")}}):void layer.msg("请选择旗帜"):void layer.msg("请填写“备注”。")},x=function(){var t={};t.trades_id=$("#tradeid").val(),t.goods_id=$("#goods_id").val(),$.ajax({type:"POST",data:t,url:e.getHost()+"/order/setCommentDetail",success:function(e){var t=JSON.parse(e);t.status?$.alert({title:"温馨提示!",body:"交易已成功！"}):$.alert({title:"温馨提示!",body:t.result.msg})}})},S=function(){var t={};t.trades_id=$("#trade-id").val();var a=parseFloat($("#cash-need").html()||0),o=parseFloat($("#odd-change").html()),n=parseFloat($("#cash-payment-pay").val().replace(/^(\-)*(\d+)\.(\d\d).*$/,"$1$2.$3"));if(t.medical_insurance_card_pay=parseFloat($("#medical-insurance-card-pay").val().replace(/^(\-)*(\d+)\.(\d\d).*$/,"$1$2.$3")||0),t.line_breaks_pay=parseFloat($("#line-breaks-pay").val().replace(/^(\-)*(\d+)\.(\d\d).*$/,"$1$2.$3")||0),t.cash_payment_pay=(n-o).toFixed(2),t.cash_receipt_note=$("#cash-receipt-note").val(),t.line_breaks_pay>=a)return void layer.msg("优惠金额必须小于实付款!");if(t.medical_insurance_card_pay>a-t.line_breaks_pay)return void layer.msg("医保卡金额必须小于(实付款-优惠)!");if(0>o)return void layer.msg("找零不能小于0!");var i=$("#linkSize").val();$.ajax({type:"POST",data:t,url:e.getHost()+"/order/setPayTradesByCashReceipts",success:function(e){var t=JSON.parse(e);t.status&&1==$("#print_xiaopiao").prop("checked")?layer.confirm("提交成功，即将打开打印小票页面",{btn:["OK"]},function(){window.open("/print/receipt?tid="+$("#trade-id").val()+"&cash="+$("#cash-payment-pay").val()+"&back="+$("#odd-change").html()),window.location.reload()}):t.status?layer.msg("支付成功!",{time:500,end:function(){if("index"==i){var e=$(".sui-pagination li.active a").html();r("default","all",e),$("#cash-receipt").modal("hide")}else{var e=$(".sui-pagination li.active a").html();r("default","buying",e),$("#cash-receipt").modal("hide")}}}):layer.msg("请填写支付金额!")}})},C=function(){var t={};t.id=$("#idDown").val(),t.phone=$("#phoneDown").val(),t.trades_status=$("#trades_statusDown").val(),t.post_style=$("#post_styleDown").val(),t.clerk_invitation_code=$("#clerk_invitation_codeDown").val(),t.start_time=$("#start_timeDown").val(),t.end_time=$("#end_timeDown").val(),t.trades_rank=$("#trades_rankDown").val(),t.pay_style=$("#pay_styleDown").val(),t.total_items=$("#total_items").val(),$("#reportDown-text").html("正在处理，请稍后....."),$.ajax({type:"POST",data:t,url:e.getHost()+"/order/getOrdersByTime",success:function(a){var o=JSON.parse(a);o.status?t.total_items>1e3?$("#reportDown-text").html('<div>查询结果<span class="sui-text-danger">'+t.total_items+'</span>条，超过导出最大值！</div><div>请修改查询时间后再试哦~</div><div class="sui-text-danger">*每次最多可以导出100条，超过时请分批次下载</div>'):$("#reportDown-text").html('共查询到 <span class="sui-text-danger">'+t.total_items+'</span> 条记录，<a href="'+e.getHost()+"/order/export?"+$.param(t)+'">点击下载报表</a>'):$("#reportDown-text").html('共查询到 <span class="sui-text-danger">0</span> 条记录，<a href="javascript:void(0);">点击下载报表</a>')}})},O=function(){var t={};t.authcode=$("#auth_code").val(),t.tradesid=$("#trades_id").val(),t.since=$("#since").val(),$.ajax({type:"POST",data:t,url:e.getHost()+"/order/confirmReceipt",success:function(e){var t=JSON.parse(e);t.status?layer.msg("提货成功，谢谢！",function(){var e=$(".sui-pagination li.active a").html();r("default","since",e),$("#authcode-modal").modal("hide")}):layer.msg(t.result.msg)}})},T=function(){var t=window.location.hash?window.location.hash:"#no";t=t.substr(1,t.length),window.location.hash=t,orders=t.split("&");var a=orders[1];if(a.length>0){$.ajax({type:"post",url:e.getHost()+"/order/birdExpress",data:{trans_id:a},success:function(t){var a=JSON.parse(t);a.status?layer.alert('<h2 style="margin-top: -5px!important;">通知成功</h2>已成功通知第三方物流',{title:"配送信息",icon:1,area:"500px"},function(){window.location.href=e.getHost()+"/order/todoor"}):layer.msg("通知不成功("+a.result.msg+")")}})}},D=function(t){$.ajax({type:"post",url:e.getHost()+"/order/expressList",data:{trans_id:t},success:function(e){function a(e){switch(parseInt(e)){case 0:step_name="已通知";break;case 1:case 2:case 3:step_name="已接单";break;case 4:step_name="已取单";break;case 5:step_name="已送达";break;case 6:step_name="已取消";break;case 7:step_name="拒绝接单";break;case 8:step_name="已退回";break;default:step_name="无效的状态"}return step_name}var o=JSON.parse(e);if(o.result.waybill_number)var r=o.result.waybill_number;else var r="无";if(o.result.diliveryman)var n=o.result.diliveryman;else var n="无";if(o.result.distribution_phone)var i=o.result.distribution_phone;else var i="无";var s="";1!=o.result.status&&2!=o.result.status&&3!=o.result.status||(s+='<button class="sui-btn cancel_btn btn-warning  style="margin-left: 200px;">取消本次送货</button><button class="sui-btn get_goods btn-warning  style="margin-left: 200px;">确认快递员取货</button><input type="hidden" name="log_num" value="'+r+'"><input type="hidden" name="trades_id" value="'+t+'">'),4==o.result.status&&(s+='<button class="sui-btn btn-warning send_goods" style="margin-left: 200px;">确认送达</button><input type="hidden" name="log_num" value="'+r+'"><input type="hidden" name="trades_id" value="'+t+'">');var l='<div id="order_info">订单号：'+t+"</br>运单号："+r+"</br>快递公司："+o.result.logistics_name+"</br>快递员："+n+"</br>电话："+i+"</br>当前状态："+a(o.result.status)+s+"</br></div>",d=new Array;o.status?($.each(o.result.items,function(e,t){step_name=a(t.status),d.push('<li><div class="left"><div class="line"></div><div class="step"></div></div><div class="right"><span class="step_name">'+step_name+'</span><span class="step_date">'+t.inform_time+'</span></div><div class="cl"></div></li>')}),l+='<div id="step_list"><ul><i class="sui-icon icon-chevron-up"></i>'+d.join("")+"</ul></div>",layer.alert(l,{title:"配送物流信息",area:"500px",btn:["关闭"]})):layer.msg("没有物流信息")}})},H=function(t){$.ajax({url:e.getHost()+"/order/setShipping",type:"post",data:t,dataType:"json"}).done(function(t){t&&t.status?($("#selectShipping-Modal").modal("hide"),layer.alert(t.result.msg,{time:3e3,end:function(){window.location.href=e.getHost()+"/order/"+(orders[0]||"todoor")}})):layer.alert(t.result.msg)})},q=function(t){$.ajax({url:e.getHost()+"/order/pushCancel",type:"post",data:{order_number:t},dataType:"json"}).done(function(e){e&&e.status?layer.alert(e.result.msg,{time:3e3,end:function(){location.reload()}}):layer.alert(e.result.msg)})},T=function(){var t=window.location.hash?window.location.hash:"#no";t=t.substr(1,t.length),window.location.hash=t,orders=t.split("&");var a=orders[1];if(a.length>0){return $.ajax({type:"post",url:e.getHost()+"/order/birdExpress",data:{trans_id:a},success:function(t){var a=JSON.parse(t);a.status?layer.alert('<h2 style="margin-top: -5px!important;">通知成功</h2>已成功通知第三方物流',{title:"配送信息",icon:1,area:"500px"},function(){window.location.href=e.getHost()+"/order/todoor"}):layer.msg("通知不成功("+a.result.msg+")")}})}return $.Deferred().resolve().promise()},D=function(t){$.ajax({type:"post",url:e.getHost()+"/order/expressList",data:{trans_id:t},success:function(e){function a(e){switch(parseInt(e)){case 0:step_name="已通知";break;case 1:case 2:case 3:step_name="已接单";break;case 4:step_name="已取单";break;case 5:step_name="已送达";break;case 6:step_name="已取消";break;case 7:step_name="拒绝接单";break;case 8:step_name="已退回";break;default:step_name="无效的状态"}return step_name}var o=JSON.parse(e);if(o.result.waybill_number)var r=o.result.waybill_number;else var r="无";if(o.result.diliveryman)var n=o.result.diliveryman;else var n="无";if(o.result.distribution_phone)var i=o.result.distribution_phone;else var i="无";var s="";1!=o.result.status&&2!=o.result.status&&3!=o.result.status||(s+='<button class="sui-btn cancel_btn btn-warning" style="margin-left:90px;">取消本次送货</button><button class="sui-btn get_goods btn-warning" style="margin-left:10px;">确认快递员取货</button><input type="hidden" name="log_num" value="'+r+'"><input type="hidden" name="trades_id" value="'+t+'">'),4==o.result.status&&(s+='<button class="sui-btn btn-warning send_goods" style="margin-left: 200px;">确认送达</button><input type="hidden" name="log_num" value="'+r+'"><input type="hidden" name="trades_id" value="'+t+'">');var l='<div id="order_info">订单号：'+t+"</br>运单号："+r+"</br>快递公司："+o.result.logistics_name+"</br>快递员："+n+"</br>电话："+i+"</br>当前状态："+a(o.result.status)+s+"</br></div>",d=new Array;o.status?($.each(o.result.items,function(e,t){step_name=a(t.status),d.push('<li><div class="left"><div class="line"></div><div class="step"></div></div><div class="right"><span class="step_name">'+step_name+'</span><span class="step_date">'+t.inform_time+'</span></div><div class="cl"></div></li>')}),l+='<div id="step_list"><ul><i class="sui-icon icon-chevron-up"></i>'+d.join("")+"</ul></div>",layer.alert(l,{title:"配送物流信息",area:"500px",btn:["关闭"]})):layer.msg("没有物流信息")}})},H=function(t){$.ajax({url:e.getHost()+"/order/setShipping",type:"post",data:t,dataType:"json"}).done(function(t){t&&t.status?($("#selectShipping-Modal").modal("hide"),layer.alert(t.result.msg,{time:3e3,end:function(){window.location.href=e.getHost()+"/order/"+(orders[0]||"todoor")}})):layer.alert(t.result.msg)})},q=function(t){return $.ajax({url:e.getHost()+"/order/pushCancel",type:"post",data:{order_number:t},dataType:"json"}).done(function(e){e&&e.status?layer.alert(e.result.msg,{time:3e3,end:function(){location.reload()}}):layer.alert(e.result.msg)})};return{save_goods_batch_no:k,showAllOrder:r,showDetail:s,batchConfirm:l,checkAll:d,batchStocking:c,popOrders:n,showStocking:p,flushStocking:h,batchToDoor:f,confirmReceipt:_,userTakedelivery:b,showClerk:m,goToDoor:g,setPageSize:o,showCountOrder:y,showseller:w,showCommentDetail:x,sendSinceCode:v,showPayTradesByCashReceipts:S,showreportDown:C,showconfirmReceipt:O,birdExpress:T,birdExpressList:D,getGoods:H,cancelPush:q}}),define("tools",[],function(){var e=function(e,o,r){var n,i=!1;switch(e){case"member":n=new RegExp("^[0-9]*$"),n.test(o)&&(i=!0);break;case"mobile":n=/^(((13[0-9]{1})|(14[0-9]{1})|(15[0-9]{1})|(17[0-9]{1})|(18[0-9]{1}))+\d{8})$/,n.test(o)&&(i=!0);break;case"gt":parseInt(o)>parseInt(r)&&(i=!0);break;case"lt":parseInt(o)<parseInt(r)&&(i=!0);break;case"max":a(o)<=parseFloat(r)&&(i=!0);break;case"min":a(o)>=parseFloat(r)&&(i=!0);break;case"cmax":0!=o.length&&(n=/^[\u4E00-\u9FA5]+$/,n.test(o)&&a(o)<=parseFloat(r)&&(i=!0));break;case"cmin":0!=o.length&&(n=/^[\u4E00-\u9FA5]+$/,n.test(o)&&a(o)>=parseFloat(r)&&(i=!0));break;case"idcard":var s=t(o);s&&(i=!0);break;case"email":0!=o.length&&(n=/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,n.test(o)&&(i=!0));break;case"qq":n=/^\d{5,15}$/,n.test(o)&&(i=!0)}return i},t=function(e){if(e=e.toUpperCase(),!/(^\d{15}$)|(^\d{17}([0-9]|X)$)/.test(e))return!1;var t,a;if(t=e.length,15==t){a=new RegExp(/^(\d{6})(\d{2})(\d{2})(\d{2})(\d{3})$/);var o,r=e.match(a),n=new Date("19"+r[2]+"/"+r[3]+"/"+r[4]);if(o=n.getYear()==Number(r[2])&&n.getMonth()+1==Number(r[3])&&n.getDate()==Number(r[4])){var i,s=new Array(7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2),l=new Array("1","0","X","9","8","7","6","5","4","3","2"),d=0;for(e=e.substr(0,6)+"19"+e.substr(6,e.length-6),i=0;17>i;i++)d+=e.substr(i,1)*s[i];return e+=l[d%11],!0}return!1}if(18==t){a=new RegExp(/^(\d{6})(\d{4})(\d{2})(\d{2})(\d{3})([0-9]|X)$/);var o,r=e.match(a),n=new Date(r[2]+"/"+r[3]+"/"+r[4]);return o=n.getFullYear()==Number(r[2])&&n.getMonth()+1==Number(r[3])&&n.getDate()==Number(r[4]),!!o}return!1},a=function(e){for(var t=0,a=0;a<e.length;a++){var o=e.charAt(a);t+=encodeURI(o).length>2?1:.5}return console.log(e+" length:"+t),t},o=function(e,t,a){var o=new Date;o.setDate(o.getDate()+a),document.cookie=e+"="+escape(t)+(null==a?"":";expires="+o.toGMTString())},r=function(e){return document.cookie.length>0&&(c_start=document.cookie.indexOf(e+"="),-1!=c_start)?(c_start=c_start+e.length+1,c_end=document.cookie.indexOf(";",c_start),-1==c_end&&(c_end=document.cookie.length),unescape(document.cookie.substring(c_start,c_end))):""};return{validate:e,getStringLength:a,setCookie:o,getCookie:r}}),define("create",["core","tools"],function(core,tools){var mod={};return mod.shopcar={},mod.shopcarinfo={},mod.searchGoods=function(){var e=$("#item_title").val();if(e.replace(/(^\s*)|(\s*$)/g,"").length>0){var t={};t.title=e,t.pagesize=100,t.pageno=0,$.ajax({type:"POST",data:t,url:core.getHost()+"/order/searchGoods",success:function(e){var t=JSON.parse(e);if(0==t.responseHeader.status){var a=$("#goods_template").html(),o=doT.template(a),r=o(t);$("#goods_list").html(r),$("#search_lab").css("display","block")}else $.alert({title:"温馨提示!",backdrop:"static",body:"没有找到相关信息！"})}})}},mod.addShopCar=function(e){mod.shopcar[e]=1},mod.changeShopCar=function(e,t,a){"update"==e?mod.shopcar[t]+parseInt(a)>0&&(mod.shopcar[t]+=parseInt(a)):"set"==e&&(mod.shopcar[t]=parseInt(a));var o={product_id:t,product_num:mod.shopcar[t],product_price:mod.shopcarinfo[t]};return o},mod.delShopCar=function(e){var t={};for(var a in mod.shopcar)e!=a&&(t[a]=mod.shopcar[a]);mod.shopcar=t},mod.showShopCar=function(e){var t={items:""};for(var a in mod.shopcar)"num"!=a&&(t.items=t.items+a+",");""!=t.items?$.ajax({type:"POST",data:t,url:core.getHost()+"/order/getItemsInfo",success:function(t){var a=JSON.parse(t);if(a.status){for(var o=0,r=a.result.goods.length;r>o;o++)a.result.goods[o].product_num=mod.shopcar[a.result.goods[o].product_id],mod.shopcarinfo[a.result.goods[o].product_id]=a.result.goods[o].product_price;"undefined"==typeof e&&(e="shopcar_template");var n=$("#"+e).html(),i=doT.template(n),s=i(a);$("#shopcar_list").html(s)}else $.alert({title:"温馨提示!",backdrop:"static",body:a.result.msg})}}):$("#shopcar_list").html("")},mod.ValidateinputChange=function(value,control){var flag=!0;control=parseInt(control);var defaultvalue=1;if(0==value.length&&(defaultvalue=1,flag=!1),!new RegExp(/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/).test(value)){parseInt(value)<=0?(defaultvalue=1,flag=!1):0!=control&&parseInt(value)>control?(defaultvalue=control,flag=!1):parseInt(value)>100&&(defaultvalue=100,flag=!1);var exp=eval("/^[0-9]*$/");exp.test(value)||(defaultvalue=1,flag=!1)}return flag&&(defaultvalue=value),defaultvalue},mod.CalculationShopCar=function(){var e=0,t=0;for(var a in mod.shopcar)e+=mod.shopcar[a],t+=mod.shopcar[a]*mod.shopcarinfo[a];var o={type_num:Object.keys(mod.shopcar).length,item_num:e,item_total:t};return o},mod.calculate=function(e,t){if(Object.keys(mod.shopcar).length>0){var a={};a.user=JSON.stringify({mobile:e}),a.integral=t;var o=[];for(var r in mod.shopcar){var n={product_id:r,product_num:mod.shopcar[r]};o.push(n)}a.goods=JSON.stringify(o),$.ajax({type:"POST",data:a,async:!1,url:core.getHost()+"/order/createCalculate",success:function(e){console.log("结算:"+e);var t=JSON.parse(e);if(t.status){var a=$("#calculate_template").html(),o=doT.template(a),r=o(t);$("#create_commit").html(r)}else $.alert({title:"温馨提示!",backdrop:"static",body:t.result.msg})}})}},mod.commitOrder=function(e,t,a){var o=!0;if(Object.keys(mod.shopcar).length>0){var r={};r.user=JSON.stringify({mobile:e}),r.storemember=t,r.integral=a;var n=[];for(var i in mod.shopcar){var s={product_id:i,product_num:mod.shopcar[i]};n.push(s)}r.goods=JSON.stringify(n),$.ajax({type:"POST",data:r,async:!1,url:core.getHost()+"/order/createOrder",success:function(e){console.log("下单:"+e);var t=JSON.parse(e);t.status?o=!0:($.alert({title:"温馨提示!",backdrop:"static",body:t.result.msg}),o=!1)}})}else $.alert({title:"温馨提示!",backdrop:"static",body:"请先添加商品哦！"}),o=!1;return o},mod.checkUser=function(e){var t={};tools.validate("mobile",e,null)?(t.mobile=e,$.ajax({type:"POST",data:t,async:!1,url:core.getHost()+"/order/getCheckUser",success:function(e){console.log("用户验证:"+e);var t=JSON.parse(e);t.status&&(t.result.check?$("#check_user").attr("style","display: none;"):($("#check_user").html("该会员不是您店铺的注册会员"),$("#check_user").attr("style","display: inline;")))}})):($("#check_user").html("手机号码不正确！"),$("#check_user").attr("style","display: inline;"),$("#username").val(""))},mod}),define("refund",["core"],function(e){var t={};return t.init=function(){$(document).on("change","#temp-file",function(){this.value&&$("#temp-file-form").trigger("submit")}),$(document).on("click",".del-ce",function(){$(this).parent(".ce-img").remove()}),$(document).on("keyup",".listen-input",function(){$("#js-pl-limit").html(this.value.length)})},t.addCe=function(e){var t=$(".ce-group");if(t.find(".ce-img").size()<5&&0==t.find(".ce-img .preview-img.empty").size()){var a=$("#ce-img-temp").html();t.append(a)}var o=$(".ce-img").find(".preview-img.empty").eq(0);o.find("img").attr("src",e).siblings('[name="voucher[]"]').val(e),o.removeClass("empty")},t.handleRefund=function(t){$.ajax({url:e.getHost()+"/refund/handleRefund",type:"post",data:t,dataType:"json"}).done(function(t){t&&t.status?layer.msg(t.result.msg,function(){location.href=e.getHost()+"/order/refund/handle"+location.search}):layer.alert(t.result.msg)})},t}),require.config({paths:{core:"../lovejs/core",tools:"../lovejs/tools",order:"service/order",create:"service/createorder",refund:"service/refund"}}),$(function(){require(["core"],function(e){e.doTinit(),e.ReConsole()}),setTimeout("order_message()",1e3);var e=window.location.pathname;switch(e){case"/order/index":initIndex();break;case"/order/todoor":initTodoor();break;case"/order/detail":initDetail();break;case"/order/since":initSince();break;case"/order/buying":initBuying();break;case"/order/deliverypay":initDeliverypay();break;case"/order/create":initCreate();break;case"/order/stocking":initStocking();break;case"/order/delivery":initDelivery();break;case"/order/userdelivery":initUserdelivery();break;case"/order/count":initCountTrades();break;case"/order/agreeRefund":initRefund();break;case"/order/agreeRefund/initiative":initRefund();break;case"/order/refuseRefund":initRefund()}$(document).on("click",".small-img",function(){var e=$(this).find('input[name="big"]').val();layer.open({type:1,title:!1,closeBtn:!0,shift:0,area:["auto","auto"],skin:"layui-layer-molv",shadeClose:!1,content:'<div><img src="'+e+'"/></div>'})}),$(document).on("click",".edit-memo",function(){var e=$(this).find("input:hidden").val(),t=$(this).attr("original-title"),a=$(this).attr("data-flag");$("#tradeid").val(e),$("#seller-modal").modal("show"),$(".flag-box").find('input[value="'+a+'"]').attr("checked",!0),$("#seller_memo").val(t),document.getElementById("seller_memo_num").innerHTML=document.getElementById("seller_memo").value.length}),$(document).on("click",".btn_cash_receipt",function(){var e=$(this).parents("table").find('input[id*="order"]').val(),t=$(this).parents("table").find("label:eq(0)").html(),a=$(this).parents("table").find("label:eq(1)").html(),o=$(this).parents("table").find("label:eq(2)").html(),r=$(this).parents("tr").find("#cash-total").html(),n=$(this).data("value");$("#trade-id").val(e),$(".cash-title").html(t),$(".create-time").html(a),$(".buyer-nick").html(o),$("#cash-need").html(r),$("#odd-change").html(0),$("#cash-receipt").modal("show"),$(".cash-blur").val(""),$("#cash-receipt-note").val(""),$("#linkSize").val(n)}),$(document).on("input",".cash-blur",function(){var e=parseFloat($("#cash-payment-pay").val()||0),t=parseFloat($("#medical-insurance-card-pay").val()||0),a=parseFloat($("#line-breaks-pay").val()||0),o=parseFloat($("#cash-need").html()),r=(e+t+a-o).toFixed(2);$("#odd-change").html(r),0>r?$(this).parents("#xxxx-form").find("#odd-change").css("color","red"):$(this).parents("#xxxx-form").find("#odd-change").css("color","#333")}),1==$("#print_xiaopiao").prop("checked"),$(document).on("click",".btn_reportDown",function(){var e=$("#tid").val(),t=$("#phone").val(),a=$("#trades_status").val(),o=$("post_style").val(),r=$("#clerk_invitation_code").val(),n=$("#start_time").val(),i=$("#end_time").val(),s=$("#trades_rank").val(),l=$("#pay_style").val(),d=$("#total_items_order").val();$("#reportDown").modal("show"),$("#idDown").val(e),$("#phoneDown").val(t),$("#trades_statusDown").val(a),$("#post_styleDown").val(o),$("#clerk_invitation_codeDown").val(r),$("#start_timeDown").val(n),$("#end_timeDown").val(i),$("#trades_rankDown").val(s),$("#pay_styleDown").val(l),$("#total_items").val(d),$("#reportDown-text").html(""),$("#reportDown-form .input-medium").val(""),reportDown()}),$(document).on("click",".authcode-btn",function(){var e=$(this).parents("table").find('input[id*="order"]').val(),t=$(this).data("value");$("#since").val(t),$("#trades_id").val(e),$("#authcode-modal").modal("show"),$("#auth_code").val("")})}),require(["order"],function(e){$(document).on("click","#express_btn",function(){var t=!1;return function(){return t?!1:(t=!0,void e.birdExpress().always(function(){t=!1}))}}())}),$(document).on("click",".express_alert",function(){var e=$(this);require(["order"],function(t){var a=e.siblings('input[name="trades_id"]').val();t.birdExpressList(a)})}),$(document).on("click",".get_goods",function(){layer.closeAll();var e=$(this);require(["order"],function(t){var a={};a.log_num=e.siblings('input[name="log_num"]').val(),a.log_id=8,a.trades_id=e.siblings('input[name="trades_id"]').val(),a.has_logistics=1;var o=jQuery.param(a);t.getGoods(o)})}),$(document).on("click",".send_goods",function(){layer.closeAll();var e=$(this).siblings('input[name="trades_id"]').val();todoor_Confirm(e,1)}),require(["order"],function(e){$(document).on("click",".cancel_btn",function(){var t=!1;return function(){if(t)return!1;t=!0,layer.closeAll();var a=$(this),o=a.siblings('input[name="trades_id"]').val();e.cancelPush(o).always(function(){t=!1})}}())}),define("order_index",function(){});