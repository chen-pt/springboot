function initClerk(){require(["clerk"],function(e){e.showClerks("default",1)})}function initeditClerk(){require(["clerk"],function(e){e.setinfo()})}function addClerk(){require(["clerk"],function(e){e.addClerks()})}function searchclerk(){require(["clerk"],function(e){e.showClerks("search",1)})}function editClerk(){require(["clerk"],function(e){e.editClerks()})}function deleteclerk(e){require(["clerk"],function(t){t.deleteClerks(e)})}function searchSoreOninput(){require(["clerk"],function(e){e.showstorelist()})}function linead(){require(["clerk"],function(e){e.showChangeStore()})}function getAllocateHistory(e,t){require(["clerk"],function(a){a.showAllocateHistory(e,t)})}define("core",[],function(){function submitPwd(e){$.ajax({type:"POST",data:e,url:getHost()+"/member/updatePwd",success:function(e){var t=JSON.parse(e);console.log(t),t.status?(layer.msg("密码修改成功！"),$("#pwd-modal").modal("hide")):layer.msg("密码修改失败！")}})}var doTinit=function(){doT.templateSettings={evaluate:/\[\%([\s\S]+?)\%\]/g,interpolate:/\[\%=([\s\S]+?)\%\]/g,encode:/\[\%!([\s\S]+?)\%\]/g,use:/\[\%#([\s\S]+?)\%\]/g,define:/\[\%##\s*([\w\.$]+)\s*(\:|=)([\s\S]+?)#\%\]/g,conditional:/\[\%\?(\?)?\s*([\s\S]*?)\s*\%\]/g,iterate:/\[\%~\s*(?:\%\]|([\s\S]+?)\s*\:\s*([\w$]+)\s*(?:\:\s*([\w$]+))?\s*\%\])/g,varname:"it",strip:!0,append:!0,selfcontained:!1}},getHost=function(){var e=location.origin||location.protocol+"//"+location.hostname+(80==location.port?"":":"+location.port);return e},exeError=function(e,t,a,n){if("http"==e.type){var s="status:"+t.status+" state:"+t.readyState+" text:"+a+" err:"+JSON.stringify(n);e.desc=s}console.log("错误处理："+JSON.stringify(e))},formatDate=function(){Date.prototype.format=function(e){e||(e="yyyy-MM-dd hh:mm:ss");var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var a in t)new RegExp("("+a+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[a]:("00"+t[a]).substr((""+t[a]).length)));return e}},ReConsole=function(){window.console=window.console||function(){var e={};return e.log=e.warn=e.debug=e.info=e.error=e.time=e.dir=e.profile=e.clear=e.exception=e.trace=e.assert=function(){},e}()},isExitsFunction=function(funcName){try{if("function"==typeof eval(funcName))return!0}catch(e){}return!1},isExitsVariable=function(e){try{return"undefined"!=typeof e}catch(t){}return!1};return $(document).on("click","#branner .download",function(){try{localStorage.setItem("is_show",!0)}catch(e){}}),$(document).on("click","#upgrade-bar .sui-close",function(){try{localStorage.setItem("upgrade-version",CURRENT_VERSION)}catch(e){}}),$(document).on("shown","#pwd-modal",function(){$("#pwd-form").validate({success:function(e){var t=e.serializeArray();submitPwd(t)}})}),$(document).on("hidden","#pwd-modal",function(){$("#pwd-form")[0].reset()}),$(function(){$.ajax({type:"get",url:getHost()+"/helpful/upgrade",dataType:"json"}).done(function(e){return e.status&&e.result.items.length?($("#upgrade-bar").find(".upgrade-title").empty().append(e.result.items[0].title).end().show(),$("#upgrade").find(".upgrade-content").empty().append(e.result.items[0].content),void(200==e.result.items[0].tips_type&&$("#upgrade-bar").hide())):null})}),$(function(){$.ajax({type:"POST",url:getHost()+"/store/getGrcode",success:function(e){1!=e&&$("#grcode").attr("src",e)},error:function(e,t){console.log("status:"+e.status),console.log("state:"+e.readyState),console.log("text:"+t)}})}),{doTinit:doTinit,getHost:getHost,exeError:exeError,formatDate:formatDate,ReConsole:ReConsole,isExitsVariable:isExitsVariable,isExitsFunction:isExitsFunction}}),define("tools",[],function(){var e=function(e,n,s){var o,r=!1;switch(e){case"member":o=new RegExp("^[0-9]*$"),o.test(n)&&(r=!0);break;case"mobile":o=/^(((13[0-9]{1})|(14[0-9]{1})|(15[0-9]{1})|(17[0-9]{1})|(18[0-9]{1}))+\d{8})$/,o.test(n)&&(r=!0);break;case"gt":parseInt(n)>parseInt(s)&&(r=!0);break;case"lt":parseInt(n)<parseInt(s)&&(r=!0);break;case"max":a(n)<=parseFloat(s)&&(r=!0);break;case"min":a(n)>=parseFloat(s)&&(r=!0);break;case"cmax":0!=n.length&&(o=/^[\u4E00-\u9FA5]+$/,o.test(n)&&a(n)<=parseFloat(s)&&(r=!0));break;case"cmin":0!=n.length&&(o=/^[\u4E00-\u9FA5]+$/,o.test(n)&&a(n)>=parseFloat(s)&&(r=!0));break;case"idcard":var i=t(n);i&&(r=!0);break;case"email":0!=n.length&&(o=/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,o.test(n)&&(r=!0));break;case"qq":o=/^\d{5,15}$/,o.test(n)&&(r=!0)}return r},t=function(e){if(e=e.toUpperCase(),!/(^\d{15}$)|(^\d{17}([0-9]|X)$)/.test(e))return!1;var t,a;if(t=e.length,15==t){a=new RegExp(/^(\d{6})(\d{2})(\d{2})(\d{2})(\d{3})$/);var n,s=e.match(a),o=new Date("19"+s[2]+"/"+s[3]+"/"+s[4]);if(n=o.getYear()==Number(s[2])&&o.getMonth()+1==Number(s[3])&&o.getDate()==Number(s[4])){var r,i=new Array(7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2),l=new Array("1","0","X","9","8","7","6","5","4","3","2"),c=0;for(e=e.substr(0,6)+"19"+e.substr(6,e.length-6),r=0;17>r;r++)c+=e.substr(r,1)*i[r];return e+=l[c%11],!0}return!1}if(18==t){a=new RegExp(/^(\d{6})(\d{4})(\d{2})(\d{2})(\d{3})([0-9]|X)$/);var n,s=e.match(a),o=new Date(s[2]+"/"+s[3]+"/"+s[4]);return n=o.getFullYear()==Number(s[2])&&o.getMonth()+1==Number(s[3])&&o.getDate()==Number(s[4]),!!n}return!1},a=function(e){for(var t=0,a=0;a<e.length;a++){var n=e.charAt(a);t+=encodeURI(n).length>2?1:.5}return console.log(e+" length:"+t),t},n=function(e,t,a){var n=new Date;n.setDate(n.getDate()+a),document.cookie=e+"="+escape(t)+(null==a?"":";expires="+n.toGMTString())},s=function(e){return document.cookie.length>0&&(c_start=document.cookie.indexOf(e+"="),-1!=c_start)?(c_start=c_start+e.length+1,c_end=document.cookie.indexOf(";",c_start),-1==c_end&&(c_end=document.cookie.length),unescape(document.cookie.substring(c_start,c_end))):""};return{validate:e,getStringLength:a,setCookie:n,getCookie:s}}),define("service/pagin",[],function(){return $.fn.pagination.Constructor.prototype=$.extend($.fn.pagination.Constructor.prototype,{_drawCtrl:function(){var e="";if(this.pageSize&&this.itemsCount){var t=$('<select class="page-size-sel"></select>'),a=[15,30,50,100];for(var n in a){var s='<option value="'+a[n]+'"'+(this.pageSize==a[n]?"selected":"")+">"+a[n]+"</option>";t.append(s)}e+=t.prop("outerHTML"),e+="<div>&nbsp;"+("itemsCount"==this.displayInfoType?"<span>共"+this.itemsCount+"条</span>&nbsp;":"<span>共"+this.pages+"页</span>&nbsp;")+"("+this.itemsCount+'条记录)<span>&nbsp;到&nbsp;<input type="text" class="page-num"/><button class="page-confirm">确定</button>&nbsp;页</span></div>'}else e="<div>&nbsp;"+("itemsCount"==this.displayInfoType?"<span>共"+this.itemsCount+"条</span>&nbsp;":"<span>共"+this.pages+"页</span>&nbsp;")+'<span>&nbsp;到&nbsp;<input type="text" class="page-num"/><button class="page-confirm">确定</button>&nbsp;页</span></div>';return e},updateConfig:function(e){e.pageSize&&(this.pageSize=e.pageSize)}}),function(e,t,a,n,s,o,r){if(t=t||1,a=a||1,a||(a=Math.ceil(s/n)),"object"!=typeof e)var i=$(e);else i=e;i.data("sui-pagination",""),i.pagination({pages:a,styleClass:["pagination-large","pagination-right"],showCtrl:!0,displayPage:6,pageSize:n,itemsCount:s,currentPage:t,onSelect:o}),i.pagination("updatePages",~~a,~~t),i.data("evt-init")||(i.on("change",".page-size-sel",function(){i.pagination("updateConfig",{pageSize:+this.value}),o(1)}),i.data("evt-init",1))}}),define("clerk",["core","tools","service/pagin"],function(e,t,a){function n(){var t={};$("#store_name").val(),$("#store_id").val();t.per_page=1e6,t.stores_status=1,$.ajax({type:"POST",data:t,url:e.getHost()+"/store/getList",success:function(e){var t=JSON.parse(e);if(t.status){for(var a=[],n=0,s=t.result.items.length;s>n;n++){var o={};o.value=t.result.items[n].name,o.data=t.result.items[n].id,a[n]=o}$("#autocomplete").autocomplete({lookup:a,minChars:0,onSelect:function(e){$("#assistant_new_store").val(e.data)}})}}})}var s=15,o=function(e){s=e},r=function(t,n){var s={},o=$(".page-size-sel").val()||15;s.pagesize=o,s.pageno=n,"search"==t&&(s.start=$("#date_start").val(),s.end=$("#date_end").val(),s.mobile=$("#phone").val(),s.clerk_name=$("#clerk_name").val(),s.invite_code=$("#invite_code_input").val());var i=layer.load(1,{shade:[.1,"#fff"]}),l=new Date;$.ajax({type:"POST",data:s,url:e.getHost()+"/clerk/getClerks",success:function(e){new Date-l<1500?setTimeout(function(){layer.close(i)},1500-(new Date-l)):layer.close(i);var n=JSON.parse(e);if(1==n.status){var s=$("#list_template").html(),c=doT.template(s),u=c(n);$("#clerk_list").html(u),a("#pagelsit",+n.result.current,n.result.total_pages,o,n.result.total_items,function(e){r(t,e)})}else $("#clerk_list").html('<tr><td colspan="8"  style="text-align: center;">'+n.result.msg+"</td></tr>"),$("#pagelsit").html("")}}),console.log("展示")},i=function(){var e=$("#clerksex").val();$.isNumeric(e)&&$("input[name=sex][value="+e+"]").attr("checked",!0)},l=function(){var t={};t.mobile=$("#mobile").val(),t.password=$("#password").val(),t.name=$("#name").val(),t.name=t.name.replace(/(\s*)/g,""),t.sex=$('input[name="sex"]:checked').val(),t.idcard_number=$("#idcard").val(),t.birthday=$("#birthday").val(),t.email=$("#email").val(),t.qq=$("#qq").val(),t.clerk_job=$("#work").val(),t.memo=$("#mark").val(),t.employee_number=$("#employee_number").val(),t.status=$("[name=status]:checked").val(),t.group_ids=$('[name="group-ids[]"]:checked').map(function(){return this.value}).get().join(","),t.role_ids=$('[name="role-ids[]"]:checked').map(function(){return this.value}).get().join(",");var a=d(t);a.flag?$.ajax({type:"POST",data:t,async:!1,url:e.getHost()+"/clerk/addclerks",success:function(t){console.log("添加店员:"+t);var a=JSON.parse(t);1==a.status?layer.msg("添加店员成功！",function(){window.location.href=e.getHost()+"/clerk/index"}):$.alert({title:"温馨提示!",body:a.result.msg})}}):$.alert({title:"温馨提示!",body:a.msg})},c=function(){var t={};t.id=$("#clerkid").val(),t.mobile=$("#mobile").val(),t.password=$("#password").val(),t.name=$("#name").val(),t.name=t.name.replace(/(\s*)/g,""),t.sex=$('input[name="sex"]:checked').val(),t.idcard_number=$("#idcard").val(),t.birthday=$("#birthday").val(),t.email=$("#email").val(),t.qq=$("#qq").val(),t.clerk_job=$("#work").val(),t.memo=$("#mark").val(),t.employee_number=$("#employee_number").val(),t.status=$("[name=status]:checked").val(),t.group_ids=$('[name="group-ids[]"]:checked').map(function(){return this.value}).get().join(","),t.role_ids=$('[name="role-ids[]"]:checked').map(function(){return this.value}).get().join(",");var a=d(t);a.flag?$.ajax({type:"POST",data:t,async:!1,url:e.getHost()+"/clerk/editclerks",success:function(t){console.log("修改店员:"+t);var a=JSON.parse(t);1==a.status?layer.msg("修改店员成功！",function(){window.location.href=e.getHost()+"/clerk/index"}):$.alert({title:"温馨提示!",body:a.result.msg})}}):$.alert({title:"温馨提示!",body:a.msg})},u=function(t){var a={};a.id=t,$.ajax({type:"POST",data:a,async:!1,url:e.getHost()+"/clerk/deleteClerks",success:function(t){console.log("删除店员:"+t);var a=JSON.parse(t);a.status?$.alert({title:"温馨提示!",body:"店员删除成功",okHide:function(){window.location.href=e.getHost()+"/clerk/index"}}):$.alert({title:"温馨提示!",body:a.result.msg})}})},d=function(e){var a={flag:!0,msg:""};return t.validate("mobile",e.mobile,null)?t.validate("min",e.name.replace(/(^\s*)|(\s*$)/g,""),.5)&&t.validate("max",e.name,10)||(a.flag=!1,a.msg="姓名不能为空且不超过10个字！"):(a.flag=!1,a.msg="请填写正确的手机号！"),e.idcard_number.replace(/(^\s*)|(\s*$)/g,"").length>0&&!t.validate("idcard",e.idcard_number,null)&&(a.flag=!1,a.msg="身份证号码格式不正确！"),e.email.length>0&&!t.validate("email",e.email,null)&&(a.flag=!1,a.msg="邮箱格式不正确！"),e.email.length>0&&!t.validate("max",e.email,20)&&(a.flag=!1,a.msg="邮箱格式不正确！"),e.qq.length>0&&!t.validate("qq",e.qq,null)&&(a.flag=!1,a.msg="QQ 号格式不正确！"),e.clerk_job.length>0&&!t.validate("cmax",e.clerk_job,10)&&(a.flag=!1,a.msg="店员职业必须为汉字且不超过10个字！"),e.memo.length>0&&!t.validate("max",e.memo,200)&&(a.flag=!1,a.msg="备注不能超过200个字！"),a},g=function(){var t={};t.assistant_mobile=$("#assistant_mobile").val(),t.assistant_new_store=$("#assistant_new_store").val(),t.store_name=$("#autocomplete").val(),t.authcode=$("#auth_code").val(),t.clerk_id=$("#admin_id").val(),$.ajax({type:"POST",data:t,async:!0,url:e.getHost()+"/clerk/ChangeStore",success:function(t){console.log("门店调配:"+t);var a=JSON.parse(t);a.status?$.alert({title:"温馨提示!",body:"门店修改成功",okHide:function(){window.location.href=e.getHost()+"/clerk/index"}}):$.alert({title:"温馨提示!",body:a.result.msg})}})},p=function(t,n){var s=$("#pagelsits").find(".page-size-sel").val()||15,o={};o.pagesize=s,o.pageno=t,"search"==n&&(o.clerk_name=$("#clerk_name").val(),o.clerk_mobile=$("#clerk_mobile").val()),$.ajax({type:"POST",data:o,url:e.getHost()+"/clerk/getAllocateHistory",success:function(e){var t=JSON.parse(e);if(1==t.status){var o=$("#allocate_history").html(),r=doT.template(o),i=r(t);$("#allocate_list").html(i),a("#pagelsits",+t.result.current,t.result.total_pages,s,t.result.total_items,function(e){p(e,n)})}else $("#allocate_list").html('<tr><td colspan="8"  style="text-align: center;">'+t.result.msg+"</td></tr>"),$("#pagelsits").html("")}})};return{showClerks:r,addClerks:l,editClerks:c,deleteClerks:u,setinfo:i,setPageSize:o,showChangeStore:g,showstorelist:n,showAllocateHistory:p}}),require.config({paths:{core:"../lovejs/core",tools:"../lovejs/tools",clerk:"service/clerk"}}),$(function(){require(["core"],function(e){e.doTinit(),e.ReConsole()});var e=window.location.pathname;switch(e){case"/clerk/index":initClerk();break;case"/clerk/edit":initeditClerk()}$(document).on("click",".allocate-btn",function(){$("#ChangeStore-modal").modal("show"),$(this).parents("html").find("body").css({"overflow-y":"hidden"}),searchSoreOninput()}),$(document).on("focus","#autocomplete",function(){$(this).val("")}),$(document).on("click",".hangeStore-close",function(){$(this).parents("html").find("body").css({"overflow-y":"auto"})}),$(document).on("click","#allocate_history-btn",function(){$("#allocateHistory-modal").modal("show"),getAllocateHistory(1)}),$(document).on("click","#allocate_btn",function(){$("#allocateHistory-modal").modal("show"),getAllocateHistory(1,"search")})}),define("clerk_index",function(){});